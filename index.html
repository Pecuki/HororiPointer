<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sticker Overlay Editor</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 20px; }
    canvas { border: 1px solid #ccc; cursor: crosshair; display: block; margin: 0 auto; }
    #controls { margin-bottom: 10px; }
    input[type="file"] { margin-bottom: 10px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="imageUpload" accept="image/*" />
    <button id="saveBtn">Save Image</button>
  </div>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const imageUpload = document.getElementById("imageUpload");
    const saveBtn = document.getElementById("saveBtn");

    let backgroundImage = null;
    let sticker = new Image();
    sticker.src = "sticker.png";

    let stickerX = 100, stickerY = 100, stickerW = 100, stickerH = 100;
    let dragging = false, resizing = false;
    const resizeHandleSize = 10;
    let dragOffsetX = 0, dragOffsetY = 0;

    imageUpload.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
          backgroundImage = img;

          // Resize canvas to match uploaded image
          canvas.width = img.naturalWidth;
          canvas.height = img.naturalHeight;

          // Wait for sticker to be ready before placing it
          if (sticker.complete) {
            initializeSticker();
          } else {
            sticker.onload = initializeSticker;
          }
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function initializeSticker() {
      const aspect = sticker.naturalWidth / sticker.naturalHeight;
      stickerW = 100;
      stickerH = stickerW / aspect;
      stickerX = canvas.width / 4;
      stickerY = canvas.height / 4;
      draw();
    }

    function draw(hideHandle = false) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (backgroundImage) {
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
      }
      if (sticker.complete) {
        ctx.drawImage(sticker, stickerX, stickerY, stickerW, stickerH);
        if (!hideHandle) {
          ctx.fillStyle = "red";
          ctx.fillRect(
            stickerX + stickerW - resizeHandleSize,
            stickerY + stickerH - resizeHandleSize,
            resizeHandleSize,
            resizeHandleSize
          );
        }
      }
    }

    function isOnSticker(x, y) {
      return x >= stickerX && x <= stickerX + stickerW &&
             y >= stickerY && y <= stickerY + stickerH;
    }

    function isOnResizeHandle(x, y) {
      return x >= stickerX + stickerW - resizeHandleSize &&
             x <= stickerX + stickerW &&
             y >= stickerY + stickerH - resizeHandleSize &&
             y <= stickerY + stickerH;
    }

    canvas.addEventListener("mousedown", (e) => {
      const mx = e.offsetX;
      const my = e.offsetY;
      if (isOnResizeHandle(mx, my)) {
        resizing = true;
      } else if (isOnSticker(mx, my)) {
        dragging = true;
        dragOffsetX = mx - stickerX;
        dragOffsetY = my - stickerY;
      }
    });

    canvas.addEventListener("mousemove", (e) => {
      const mx = e.offsetX;
      const my = e.offsetY;

      if (resizing) {
        const newWidth = Math.max(20, mx - stickerX);
        const aspectRatio = sticker.naturalWidth / sticker.naturalHeight;
        stickerW = newWidth;
        stickerH = newWidth / aspectRatio;
        draw();
      } else if (dragging) {
        stickerX = mx - dragOffsetX;
        stickerY = my - dragOffsetY;
        draw();
      } else {
        canvas.style.cursor = isOnResizeHandle(mx, my) ? "nwse-resize" :
                              isOnSticker(mx, my) ? "move" : "default";
      }
    });

    canvas.addEventListener("mouseup", () => {
      dragging = false;
      resizing = false;
    });

    canvas.addEventListener("mouseleave", () => {
      dragging = false;
      resizing = false;
    });

    saveBtn.addEventListener("click", () => {
      if (!backgroundImage) {
        alert("Please upload an image first.");
        return;
      }
      draw(true); // hide red square
      const link = document.createElement("a");
      link.download = "I POINTED.png";
      link.href = canvas.toDataURL("image/png");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      draw(); // redraw with red handle after save
    });
  </script>
  <div>
  Upload a picture of your own, and them move and resize horori sticker using the red box. When you're done aligning the sticker use the download button to save your picture. Have fun ~cookie :3
</div>
</body>
</html>
